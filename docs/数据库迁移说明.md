# 数据库迁移说明 - 添加子分类字段

## 📋 说明

为了支持子分类功能，我们添加了 `subcategory` 字段到数据库模型中。

## 🔧 自动迁移

由于使用了SQLAlchemy，数据库表结构会在应用启动时自动更新。

**但是**，如果数据库已经存在，您需要手动添加新字段或重新创建数据库。

## 方法1：重新创建数据库（推荐，如果数据可以重新爬取）

1. **备份现有数据**（如果需要）
   ```bash
   # 备份数据库文件
   copy gunpla.db gunpla.db.backup
   ```

2. **删除旧数据库**
   ```bash
   # 在项目目录中删除 gunpla.db 文件
   ```

3. **重新运行应用**
   ```bash
   py app.py
   ```
   数据库会自动创建，包含新字段

4. **重新爬取数据**
   ```bash
   py 78dm_scraper.py
   ```

## 方法2：手动添加字段（保留现有数据）

如果您想保留现有数据，可以使用SQLite命令手动添加字段：

```sql
-- 连接到数据库
sqlite3 gunpla.db

-- 添加新字段
ALTER TABLE gunpla ADD COLUMN subcategory VARCHAR(100);

-- 退出
.quit
```

或者使用Python脚本：

```python
from app import app, db
from models import Gunpla

with app.app_context():
    # SQLite不支持直接ALTER TABLE添加列（某些版本）
    # 需要创建新表并迁移数据
    # 或者使用Flask-Migrate
    
    # 简单方法：如果字段不存在，SQLAlchemy会在下次创建表时添加
    # 但现有数据需要手动更新
    pass
```

## 方法3：使用Flask-Migrate（推荐用于生产环境）

如果需要更专业的数据库迁移管理：

1. **安装Flask-Migrate**
   ```bash
   py -m pip install Flask-Migrate
   ```

2. **初始化迁移**
   ```bash
   flask db init
   flask db migrate -m "Add subcategory field"
   flask db upgrade
   ```

## ✅ 验证

添加字段后，可以验证：

```python
from app import app, db
from models import Gunpla

with app.app_context():
    # 检查字段是否存在
    gunpla = Gunpla.query.first()
    if gunpla:
        print(f"子分类字段: {gunpla.subcategory}")
```

## 💡 建议

- **开发阶段**：如果数据不多，建议使用方法1（重新创建）
- **生产环境**：使用方法3（Flask-Migrate）进行专业迁移
- **已有大量数据**：使用方法2（手动添加字段），然后运行爬虫更新子分类
