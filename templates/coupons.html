{% extends "base.html" %}

{% block title %}优惠券管理 - 高达价格查询工具{% endblock %}

{% block content %}
<h1 class="mb-4">优惠券管理</h1>

<div class="mb-3">
    <a href="{{ url_for('coupon_add') }}" class="btn btn-success">添加优惠券</a>
</div>

{% if coupons %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>平台</th>
                <th>折扣类型</th>
                <th>折扣值</th>
                <th>最高减免</th>
                <th>有效期</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for coupon in coupons %}
            <tr>
                <td><strong>{{ coupon.platform }}</strong></td>
                <td>
                    {% if coupon.discount_type == 'percentage' %}
                        <span class="badge bg-primary">百分比</span>
                    {% else %}
                        <span class="badge bg-secondary">固定金额</span>
                    {% endif %}
                </td>
                <td>
                    {% if coupon.discount_type == 'percentage' %}
                        {{ "%.1f"|format(coupon.discount_value) }}%
                    {% else %}
                        ¥{{ "%.2f"|format(coupon.discount_value) }}
                    {% endif %}
                </td>
                <td>
                    {% if coupon.max_discount %}
                        ¥{{ "%.2f"|format(coupon.max_discount) }}
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if coupon.valid_from and coupon.valid_until %}
                        {{ coupon.valid_from.strftime('%Y-%m-%d') }} 至 {{ coupon.valid_until.strftime('%Y-%m-%d') }}
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if coupon.is_valid() %}
                        <span class="badge bg-success">有效</span>
                    {% else %}
                        <span class="badge bg-danger">无效</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('coupon_analyze', coupon_id=coupon.id) }}" class="btn btn-sm btn-info">分析</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">
    <h4>暂无优惠券</h4>
    <p>还没有添加任何优惠券，<a href="{{ url_for('coupon_add') }}">点击这里添加第一个</a></p>
</div>
{% endif %}
{% endblock %}

