{% extends "base.html" %}

{% block title %}分享清单 - 高达价格查询工具{% endblock %}

{% block content %}
<h1 class="mb-4">分享清单</h1>

<div class="mb-3 text-muted">
    {% if owner %}
        <span>分享者：{{ owner.username }}</span>
    {% endif %}
    <span class="ms-2">类型：{{ '想要列表' if share_link.list_type == 'wishlist' else '已购买列表' }}</span>
</div>

{% if items %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>名称</th>
                <th>级别</th>
                {% if share_link.list_type == 'wishlist' %}
                <th>日本定价</th>
                <th>中国市场价</th>
                <th>算</th>
                <th>添加时间</th>
                {% else %}
                <th>购买价格</th>
                <th>购买平台</th>
                <th>购买日期</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>
                    {% if item.gunpla %}
                        <strong>{{ item.gunpla.name_cn }}</strong>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if item.gunpla %}
                        <span class="badge bg-info">{{ item.gunpla.grade }}</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                {% if share_link.list_type == 'wishlist' %}
                <td>
                    {% if item.gunpla and item.gunpla.price_jp_msrp %}
                        ¥{{ "%.0f"|format(item.gunpla.price_jp_msrp) }}
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if item.gunpla and item.gunpla.price_cn_market %}
                        <span class="price-value">¥{{ "%.2f"|format(item.gunpla.price_cn_market) }}</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if item.gunpla %}
                        {% set suan = item.gunpla.calculate_suan() %}
                        {% if suan %}
                            <span class="suan-badge">{{ "%.1f"|format(suan) }}算</span>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>{{ item.added_at.strftime('%Y-%m-%d') if item.added_at else '-' }}</td>
                {% else %}
                <td>
                    {% if item.purchase_price %}
                        <span class="price-value">¥{{ "%.2f"|format(item.purchase_price) }}</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>{{ item.purchase_platform or '-' }}</td>
                <td>{{ item.purchase_date.strftime('%Y-%m-%d') if item.purchase_date else '-' }}</td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">
    <h4>列表为空</h4>
    <p>此分享清单暂时没有内容。</p>
</div>
{% endif %}
{% endblock %}
